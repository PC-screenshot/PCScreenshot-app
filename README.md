# llw-Screenshot 截图工具（以开发成员姓名首字母命名）

基于 **Qt 6.9 + VS2022** 开发的一款桌面截图与标注工具，目标是做一款**自己也愿意长期使用**的一站式截图应用：既覆盖日常截图需求，又集成 AI接口、本地 OCR、滚动长截图、自动窗口识别等各种进阶能力。

---

## 1. 功能概览

- **屏幕捕捉**
  - 支持全屏截图、任意矩形区域截图
  - 支持自动识别并高亮当前鼠标所在窗口，一键截取该窗口
  - 类似 Snipaste，能够识别窗口中的子窗口并单独截取

- **图片保存 & 剪贴板**
  - 截图结果支持以 **Bitmap / PNG / JPEG** 等格式保存到剪贴板
  - 支持保存到本地文件（自动以时间命名）

- **标注与形状编辑**
  - 在截图上绘制 **矩形、椭圆、箭头、自由画笔** 等标注
  - 工具栏中可调节 **颜色、线宽**，支持撤销 / 重做

- **打码与模糊**
  - 支持对任意矩形区域进行 **马赛克** 和 **高斯模糊** 处理
  - 强度可调，配合撤销 / 重做，编辑体验顺滑

- **窗口自动识别**
  - 利用 Windows UI Automation 自动查找鼠标下最合适的 UI 元素
  - 截图前自动高亮窗口边界，点击即可完成窗口截图

- **区域放大镜**
  - 截图过程中，在鼠标附近显示放大镜视图
  - 方便像素级对齐、精确框选边界

- **Pin 到桌面**
  - 将截图以无边框小窗的形式 **贴在桌面最上层**
  - 便于对照抄写、比对内容，也支持对 Pin 图继续进行 OCR 等操作

- **本地 OCR 文字识别**
  - 集成 **PaddleOCR** 本地识别引擎
  - 直接对选中区域进行文字提取，识别结果以对话框展示并支持一键复制
  - 不依赖大模型接口，速度快、无 token 成本

- **AI 接口（图片描述 & 随截随问）**
  - 内置 AI 对话框，对接大模型 API
  - 一键自动生成截图的中文描述（3–5 句）
  - 可以在同一个对话框里对这张图片进行任意 prompt 提问，做到“截完就问”

- **滚动长截图**
  - 在选中一个固定框后，允许用户滚动网页或代码窗口
  - 程序自动按帧截取滚动出的内容，并向下拼接成一张长图
  - 右侧同时显示实时预览，随滚动逐渐“长高”

- **丰富的编辑工具**
  - 自由画笔、对象级 & 像素级橡皮擦
  - 撤销 / 重做
  - 完成后可选择：复制到剪贴板 / 保存文件 / Pin 到桌面 / 直接走 OCR / 走 AI 描述

---

## 2. 头文件 / 模块说明

| 头文件 | 作用简介 |
|--------|----------|
| **AiDescribeDialog.h** | AI 描述与问答对话框。负责展示截图缩略图、发送 HTTP 请求到大模型 API，接收并显示图片描述或用户自定义 prompt 的回答。支持复制文本、多轮提问等。 |
| **BlurTool.h** | 模糊工具模块。封装高斯模糊的参数设置与 UI，提供 `applyEffect` 等接口，对指定矩形区域进行模糊处理。 |
| **EditorToolbar.h** | 截图界面主工具栏。通过一个结构体数组配置所有工具按钮（类型、分组、是否可选、图标资源等），统一管理绘制类工具、AI/OCR/LongShot、保存/取消/完成等操作，并发出 `ToolSelected` 信号。 |
| **LongShotCapture.h** | 滚动长截图核心逻辑。记录选区在全局坐标中的位置，定时抓取目标窗口的当前帧，检测变化后将每一帧按顺序竖向拼接生成长图，并在右侧显示预览。最终结果支持复制和保存。 |
| **MainWindow.h** | 程序主窗口入口。负责主界面的初始化、菜单/托盘/快捷键等与系统层面的集成（启动截图、退出应用等）。 |
| **MosaicTool.h** | 马赛克工具模块。负责马赛克强度的设置 UI，并提供静态接口对截图局部进行“方块化”处理，用于隐私打码。 |
| **BlurTool.h** | 同上，模糊工具，与 MosaicTool 类似但使用高斯模糊。 |
| **OCR.h** | 本地 OCR 引擎封装。负责加载 PaddleOCR 模型、对输入图片执行识别，并向上层返回识别的文本结果。 |
| **OcrResultDialog.h** | OCR 结果展示对话框。显示识别出的文本，支持复制、简单排版和状态提示。 |
| **PinnedWindow.h** | “Pin 到桌面”模块。把一张截图以无边框置顶窗口的方式贴在桌面上，支持拖动、关闭、叠加 OCR 等操作，方便对照使用。 |
| **RegionMagnifier.h** | 区域放大镜模块。接收当前整屏截图及鼠标位置，在截图时绘制一个小窗，以更高倍数显示鼠标附近的像素，并带有十字准星辅助对齐。 |
| **ScreenCaptureManager.h** | 截图调度管理器。负责触发全屏截图、创建 `ScreenshotOverlay`，管理不同截图模式（普通截图 / 长截图等）的切换，是程序的“截屏总控”。 |
| **ScreenshotOverlay.h** | 截图时覆盖在桌面上的全屏透明窗口，是整个交互的“主战场”。负责：绘制暗色遮罩与选区高亮、响应鼠标拖拽完成选区、集成绘图/马赛克/模糊/橡皮擦工具、调度 LongShotCapture、呼出 AI / OCR / Pin / 保存等功能。 |
| **SecondaryToolBar.h** | 二级工具栏。根据当前选中的工具显示不同的参数面板，例如画笔/形状的颜色与粗细、橡皮擦模式（对象擦除 / 像素擦除）等。 |
| **ShapeDrawer.h** | 形状绘制辅助模块。集中定义各种标注对象的数据结构（矩形、椭圆、箭头、手绘路径等）及其绘制逻辑，并与撤销 / 重做栈配合使用。 |
| **UIInspector.h** | 窗口识别模块。基于 Windows UI Automation 接口，从鼠标位置出发沿 Z 轴查找真实目标窗口，并在控件树中寻找“既包含鼠标又尽可能小”的元素，最终返回一个最合适的矩形区域用于自动窗口高亮与一键截图。 |

> 说明：以上说明是从代码与命名出发的模块角色总结，具体实现细节可以参考对应 `.cpp` 文件。

---

## 3. 项目亮点

### 3.1 功能高度集成，一站式截图工具

- 将常见截图能力与附加工具集成在一个应用中：
  - 区域截图 / 窗口截图 / 长截图
  - 形状标注、马赛克、高斯模糊、橡皮擦
  - 本地 OCR、AI 描述、Pin 到桌面
- 使用者可以在一个界面里完成“截 → 标注 → 打码 → 识字 / 问 AI → 保存 / Pin”的完整流程，减少在多个软件之间来回切换的成本。

### 3.2 AI 能力深度融合，而不是外挂一个网页

- 目前主流截图工具很少原生接入大模型接口。
- 本项目中，AI 模块和截图流程深度打通：
  - 截完图自动弹出 AI 描述，对当前图片生成 3–5 句中文总结。
  - 同一个对话框中可以直接对这张图进行任意 prompt 询问，无需再把图片保存后拷贝到浏览器或其他客户端。

### 3.3 区域式马赛克 / 模糊，编辑体验更加“丝滑”

- 采用**矩形区域**作为马赛克 / 模糊单位，而不是“小圆圈一点点涂”。
- 只需框选目标区域即可完成打码，效率更高；支持强度调节和撤销 / 重做，体验更贴近专业截图软件。

### 3.4 本地高性能 OCR，节省 token 和费用

- 内置 PaddleOCR，本地完成文字识别：
  - 识别速度快，不依赖网络和大模型接口。
  - 对频繁截图取字的场景（技术文档、论文、代码片段等）更加友好。
- 避免使用通用大模型做 OCR 时的 token 消耗和调用成本。

### 3.5 精细的窗口识别与选区体验

- 基于 UIAutomation，对鼠标所在位置进行多层级窗口/控件搜索：
  - 能够识别窗口中的子区域（如浏览器标签页、对话框等）。
  - 截图时自动高亮当前窗口边界，一键点击即可生成选区。
- 配合区域放大镜，实现像素级对齐与边界控制。

### 3.6 结构化的工具栏与可扩展设计

- 工具栏通过一个 `ToolConfig` 结构体数组统一配置：
  - 每个工具包含类型、显示文本、是否可选中、分组 ID、图标等信息。
  - 增删工具只需在配置表中加一行 / 改一行，利于后续扩展。
- 各功能模块（AI、OCR、LongShot、Mosaic/Blur 等）解耦良好，通过 `ScreenshotOverlay` 进行统一调度，便于后续在此基础上继续扩展新工具。

---

> 如果你对这个项目感兴趣，欢迎 Star / Fork，也欢迎在 Issue 中提出体验建议或功能想法 😊  
> 我们也会继续参考主流截图工具的交互细节，持续打磨这款“自己也离不开”的截图软件。
